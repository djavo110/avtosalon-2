<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AVTO SALON</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: #f7f9fc;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      /* Navbar */
      .navbar {
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      }
      .navbar-brand {
        font-weight: bold;
        font-size: 1.5rem;
        color: #0d6efd !important;
      }
      .nav-link {
        font-weight: 500;
        transition: 0.3s;
      }
      .nav-link:hover {
        color: #0d6efd !important;
      }

      /* Sidebar */
      .list-group-item.active {
        background-color: #0d6efd;
        border-color: #0d6efd;
      }
      .list-group-item a {
        text-decoration: none;
        color: #333;
        font-weight: 500;
      }
      .list-group-item a:hover {
        color: #0d6efd;
      }

      /* Search */
      form input[type="text"] {
        border-radius: 25px;
        border: 1px solid #ced4da;
        padding: 8px 15px;
        outline: none;
        width: 250px;
        transition: all 0.3s;
      }
      form input[type="text"]:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 5px rgba(13, 110, 253, 0.5);
      }
      form button {
        border-radius: 25px;
        padding: 8px 20px;
      }

      /* Card */
      .card {
        border: none;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s;
      }
      .card:hover {
        transform: translateY(-5px);
      }
      .card img {
        border-radius: 10px;
        max-height: 250px;
        object-fit: cover;
      }
      .card-header {
        background: #0d6efd;
        color: white;
        font-weight: 600;
        font-size: 1.2rem;
      }
      .card-title {
        font-weight: bold;
        font-size: 1.3rem;
      }
      .card-text {
        font-size: 1rem;
        color: #555;
      }
      .card-footer {
        background: #f1f3f6;
        font-size: 0.9rem;
      }

      /* Suggestion Box */
      #suggestionBox {
        border: 1px solid #ced4da;
        border-radius: 10px;
        margin-top: 5px;
        background: white;
        position: absolute;
        z-index: 1000;
        width: 250px;
        display: none;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }
      #suggestionBox div {
        padding: 8px 12px;
        cursor: pointer;
      }
      #suggestionBox div:hover {
        background: #f1f1f1;
      }
    </style>
  </head>
  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white">
      <div class="container-fluid">
        <a class="navbar-brand">🚗 Avtosalon</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavAltMarkup"
          aria-controls="navbarNavAltMarkup"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav ms-auto">
            <a class="nav-link active" aria-current="page" href="{% url 'index'%}">Home</a>
            <a class="nav-link" href="{% url 'add_car' %}">Mashina Qo‘shish</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- CONTENT -->
    <div class="container-fluid mt-4">
      <div class="row">
        <!-- SIDEBAR -->
        <div class="col-12 col-md-3">
          <ul class="list-group text-center mt-4 shadow-sm">
            <li class="list-group-item active" aria-current="true">Kategoriyalar</li>
            {% for item in cat %}
            <li class="list-group-item">
              <a href="{% url 'category' item.pk %}">{{ item.title }}</a>
            </li>
            {% endfor %}
          </ul>
        </div>

        <!-- MAIN -->
        <div class="col-12 col-md-9">
          <!-- SEARCH -->
          <form method="get" class="d-flex mb-3 position-relative">
            <input
              type="text"
              id="searchInput"
              name="word"
              placeholder="🔍 Mashina qidirish..."
              value="{{ word }}"
            />
            <button type="submit" class="btn btn-primary ms-2">Qidirish</button>
            <div id="suggestionBox"></div>
          </form>

          <!-- CARS -->
          {% for item in car %}
          <div class="card mt-4">
            <div class="card-header">{{ item.model }}</div>
            <div class="card-body">
              <div class="row g-3 align-items-center">
                <div class="col-md-6 text-center">
                  {% if item.image %}
                  <img src="{{ item.image.url }}" class="img-fluid"/>
                  {% else %}
                  <img src="https://picsum.photos/400/250" class="img-fluid"/>
                  {% endif %}
                </div>
                <div class="col-md-6">
                  <h5 class="card-title">{{ item.brend }} {{ item.model }}</h5>
                  <p class="card-text">
                    <strong>Narxi:</strong> {{ item.price }} $ <br />
                    <strong>Yili:</strong> {{ item.year }} <br />
                    <strong>Rangi:</strong> {{ item.color }} <br />
                  </p>
                </div>
              </div>
            </div>
            <div class="card-footer text-muted">
              Joylangan vaqti: {{ item.created_ed }}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("searchInput");
        const suggestionBox = document.getElementById("suggestionBox");

        searchInput.addEventListener("input", function () {
          let query = this.value.trim();
          if (query.length > 0) {
            fetch(`/search-suggestions/?q=${encodeURIComponent(query)}`)
              .then((res) => res.json())
              .then((data) => {
                suggestionBox.innerHTML = "";
                if (data.length > 0) {
                  data.forEach((item) => {
                    let li = document.createElement("div");
                    li.textContent = item;
                    li.onclick = () => {
                      searchInput.value = item;
                      suggestionBox.innerHTML = "";
                    };
                    suggestionBox.appendChild(li);
                  });
                  suggestionBox.style.display = "block";
                } else {
                  suggestionBox.style.display = "none";
                }
              });
          } else {
            suggestionBox.innerHTML = "";
            suggestionBox.style.display = "none";
          }
        });

        document.addEventListener("click", function (e) {
          if (!e.target.closest("form")) {
            suggestionBox.style.display = "none";
          }
        });
      });
    </script>
  </body>
</html>
